apiVersion: v1
kind: Secret
metadata:
  name: diracx-secrets
stringData:
{{ .Values.diracx.settings | toYaml | indent 2 }}
{{- if and .Values.developer.enabled .Values.mysql.enabled }}
  {{- range $dbName := .Values.diracx.mysqlDatabases }}
  DIRACX_DB_URL_{{ $dbName | upper }}: "mysql+aiomysql://{{ $.Values.mysql.auth.username }}:{{ $.Values.mysql.auth.password }}@{{ $.Release.Name }}-mysql:3306/{{ $dbName }}"
  {{- end }}
{{- end }}
{{- if and .Values.developer.enabled .Values.opensearch.enabled }}
  {{- range $dbName := .Values.diracx.osDatabases }}
  DIRACX_OS_DB_{{ $dbName | upper }}: '{"hosts": "admin:admin@opensearch-cluster-master:9200", "use_ssl": true, "verify_certs": false}'
  {{- end }}
{{- end }}
---
apiVersion: v1
kind: Secret
metadata:
  name: diracx-web-secrets
stringData:
{{ .Values.diracxWeb.settings | toYaml | indent 2 }}
---
{{- if .Values.diracx.manageSQLSchema }}
apiVersion: v1
kind: Secret
metadata:
  name: diracx-init-mysql-secrets
stringData:
{{- if and .Values.developer.enabled .Values.mysql.enabled }}
  {{- range $dbName := .Values.diracx.mysqlDatabases }}
  DIRACX_DB_URL_{{ $dbName | upper }}: "mysql+aiomysql://root:{{ $.Values.mysql.auth.rootPassword }}@{{ $.Release.Name }}-mysql:3306/{{ $dbName }}"
  {{- end }}
{{- end }}
{{- end }}
---
{{- if .Values.diracx.manageOSIndices }}
apiVersion: v1
kind: Secret
metadata:
  name: diracx-init-os-secrets
stringData:
{{- if and .Values.developer.enabled .Values.opensearch.enabled }}
  {{- range $dbName := .Values.diracx.osDatabases }}
  DIRACX_OS_DB_{{ $dbName | upper }}: '{"hosts": "admin:admin@opensearch-cluster-master:9200", "use_ssl": true, "verify_certs": false}'
  {{- end }}
{{- end }}
{{- end }}
